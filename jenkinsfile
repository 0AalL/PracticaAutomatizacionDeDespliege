pipeline {
    agent none

    stages {

        stage('Checkout y Verificación') {
            agent any
            steps {
                echo 'Descargando el código del repositorio...'
                checkout scm 
                echo 'Listando directorios y archivos en el workspace:'
                sh 'ls -F'
            }
        }
        
        stage('levantar front') { 
            agent {  
                dockerfile {
                    dir 'frontend'
                }
            }
            steps {
                echo 'Construyendo imagen del Frontend...'
                sh '''
                    cd frontend
                    docker build -t frontend-image .
                    docker rm -f frontend-container || true
                    docker run -d --name frontend-container -p 3000:3000 frontend-image
                '''
                echo 'Frontend levantado.'
            }
        }
        
        stage('levantar back') { 
            agent {  
                dockerfile {
                    dir 'backend'
                }
            }
            steps {
                echo 'Construyendo imagen del Backend...'
                sh '''
                    cd backend
                    docker build -t backend-image .
                    docker rm -f backend-container || true
                    docker run -d --name backend-container -p 8000:8000 backend-image
                '''
                echo 'Backend levantado.'
            }
        }
    }
}
