pipeline {

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        stage('Frontend - Build & Run') {
            steps {
                dir('frontend') {
                    sh '/usr/bin/docker build -t frontend-image .'
                }
                sh '''
                    /usr/bin/docker rm -f frontend-container || true
                    /usr/bin/docker run -d --name frontend-container -p 3000:3000 frontend-image
                '''
            }
        }

        stage('Backend - Build & Run') {
            steps {
                dir('backend') {
                    sh '/usr/bin/docker build -t backend-image .'
                }
                sh '''
                    /usr/bin/docker rm -f backend-container || true
                    /usr/bin/docker run -d --name backend-container -p 4000:4000 backend-image
                '''
            }
        }
    }
}
